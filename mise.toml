[tools]
cargo-binstall = "latest"
"cargo:cargo-dist" = "latest"
"cargo:cargo-fuzz" = "latest"
"cargo:cargo-nextest" = "latest"
"cargo:release-plz" = "latest"
zig = "0.15.2"
# rust = "latest"

[tasks.fuzz]
description = "Fuzz"
run = "cargo +nightly fuzz run --target x86_64-unknown-linux-gnu fuzz_target_1"

[tasks.fuzz-cmin]
description = "Compact corpus"
run = "cargo +nightly fuzz cmin --target x86_64-unknown-linux-gnu fuzz_target_1"

[tasks.testdata]
description = "Generate test data"
run = "cargo run --release --example testdata"

[tasks.install]
description = "Install the nln binary"
run = "cargo install --path . --bin nln"

[tasks.fmt]
description = "Format code"
run = "cargo fmt --all"

[tasks."fmt:check"]
description = "Check code formatting"
run = "cargo fmt --all -- --check"

[tasks."fmt:nightly"]
description = "Format code with nightly"
run = "cargo +nightly fmt --all"

[tasks."fmt:check:nightly"]
description = "Check code formatting with nightly"
run = "cargo +nightly fmt --all -- --check"

[tasks.clippy]
description = "Run clippy lints"
run = "cargo clippy --all-targets --all-features -- -D warnings"

[tasks.test]
description = "Run tests"
run = "cargo nextest run --all-targets"

[tasks.build]
description = "Build release binary"
run = "cargo build --release"

[tasks.ci]
description = "Run all CI checks"
depends = ["fmt:check", "clippy", "test", "build"]

[tasks."zig:build"]
description = "Build optimized Zig release binary"
run = "cd nln-zig && zig build -Doptimize=ReleaseFast"

[tasks."zig:test"]
description = "Run Zig tests"
run = "cd nln-zig && zig build test --summary all"

[tasks."zig:run"]
description = "Run the Zig nln binary"
run = "cd nln-zig && zig build run"

[tasks."zig:fmt"]
description = "Format Zig code"
run = "zig fmt nln-zig/src/"

[tasks."zig:fmt:check"]
description = "Check Zig code formatting"
run = "zig fmt --check nln-zig/src/"

[tasks."zig:install"]
description = "Install Zig binary locally"
run = "cd nln-zig && zig build install --prefix ~/.local"

[tasks."zig:ci"]
description = "Run all Zig CI checks"
depends = ["zig:fmt:check", "zig:test", "zig:build"]
